# VPN Telegram Bot

Полнофункциональный Telegram бот для автоматизированного управления VPN подписками с интеграцией внешних сервисов, поддержкой множественных серверов и административной панелью.

## 📋 Обзор проекта

VPN Bot представляет собой комплексное решение для коммерческого предоставления VPN услуг через Telegram. Система автоматизирует весь цикл работы с клиентами: от регистрации и оплаты до выдачи VPN конфигураций и управления подписками.

### 🎯 Основная концепция
- **Автоматизация**: Полностью автоматический процесс от оплаты до получения VPN
- **Масштабируемость**: Поддержка множественных VPN серверов с балансировкой нагрузки
- **Мониторинг**: Интеграция с Google Sheets для отслеживания метрик и аналитики
- **Безопасность**: Автоматическая очистка истекших подписок и управление доступом

## 🏗️ Архитектура системы

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Telegram Bot  │────│  FastAPI Server │────│   VPN Servers   │
│   (Interface)   │    │   (Backend)     │    │   (Multiple)    │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                        │                        │
         │                        │                        │
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│  Payment API    │    │    Database     │    │  Google Sheets  │
│ (Donate Stream) │    │ (SQLite/Postgres)│    │   (Analytics)   │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

### 🔧 Ключевые компоненты

#### 1. **Telegram Bot Interface**
- Пользовательский интерфейс для взаимодействия с системой
- Обработка команд и callback запросов
- Админ-панель для управления пользователями и серверами
- Автоматическая рассылка и уведомления

#### 2. **Payment System**
- Интеграция с Wata API для обработки платежей
- Автоматическое продление подписок после оплаты
- Система балансов и транзакций

#### 3. **VPN Management**
- Автоматическое создание и управление VPN конфигурациями
- Поддержка множественных серверов с автоматическим распределением
- Мониторинг состояния серверов и пользователей
- Автоматическая очистка неактивных конфигураций

#### 4. **Database Layer**
- Поддержка SQLite (разработка) и PostgreSQL (продакшен)
- Система миграций для обновления схемы БД
- Отношения между пользователями, серверами и платежами
- Индексирование для производительности

#### 5. **Analytics & Monitoring**
- Интеграция с Google Sheets для аналитики
- Автоматическая синхронизация данных пользователей и платежей
- Отчеты по использованию серверов
- Метрики активности пользователей

#### 6. **Scheduler & Automation**
- Автоматическая очистка истекших подписок
- Ежедневные отчеты для администраторов
- Мониторинг состояния серверов
- Автоматические уведомления

## 🚀 Возможности системы

### Для пользователей:
- 🆓 **Пробный период** - бесплатный VPN на 30 дней для новых пользователей
- 💳 **Простая оплата** - оплата через СБП и другие платежные системы
- 🔑 **Автоматическое получение VPN** - конфигурация готова сразу после оплаты
- 📱 **Удобный интерфейс** - все операции через Telegram
- 🔄 **Автопродление** - простое продление подписки одной кнопкой

### Для администраторов:
- 👥 **Управление пользователями** - просмотр, редактирование, удаление
- 🖥️ **Управление серверами** - добавление, настройка, мониторинг
- 📊 **Аналитика** - детальная статистика через Google Sheets
- ✉️ **Массовые рассылки** - уведомления для всех пользователей
- 🛡️ **Безопасность** - полный контроль доступа и мониторинг

### Для бизнеса:
- 💰 **Монетизация** - готовая система для продажи VPN услуг
- 📈 **Масштабируемость** - легкое добавление новых серверов
- 🤖 **Автоматизация** - минимальное участие в повседневных операциях
- 📋 **Отчетность** - автоматические отчеты и аналитика
- 🔧 **Гибкость** - настройка под различные бизнес-модели

## 📁 Структура проекта

```
VPN_Bot/
├── bot/                    # Telegram Bot логика
│   ├── handlers/          # Обработчики команд и callback'ов
│   │   ├── admin.py       # Админ-панель
│   │   ├── home.py        # Главное меню
│   │   └── payment.py     # Обработка платежей
│   ├── vpn_manager.py     # Управление VPN конфигурациями
│   ├── vpn_api.py         # API для работы с VPN серверами
│   ├── donate_api.py      # API для платежной системы
│   └── scheduler.py       # Автоматические задачи
├── db/                    # База данных
│   ├── models.py          # Модели данных (User, Server, Payment)
│   ├── database.py        # Подключение к БД
│   ├── service/           # Сервисы для работы с данными
│   └── migrations/        # Миграции БД
├── sheets/                # Интеграция с Google Sheets
│   └── sheets.py          # Синхронизация данных
├── config/                # Конфигурация
│   └── config.py          # Настройки приложения
├── api.py                 # FastAPI сервер для webhooks
├── main.py                # Точка входа приложения
└── requirements.txt       # Зависимости
```

## 🔧 Конфигурация VPN серверов

Система поддерживает два режима работы с VPN серверами:

### 1. Fallback режим (legacy)
Использует настройки из `.env` файла для одного сервера.

### 2. Мульти-серверный режим
Серверы управляются через админ-панель в Telegram:
- Добавление/удаление серверов
- Активация/деактивация
- Установка сервера по умолчанию
- Мониторинг нагрузки

## 📊 Мониторинг и аналитика

### Автоматические отчеты
- Ежедневная статистика пользователей
- Отчеты по доходам
- Мониторинг состояния серверов
- Уведомления об ошибках

### Google Sheets интеграция
- Синхронизация пользователей в реальном времени
- Автоматическое обновление платежей
- Статистика по серверам
- Экспорт данных для анализа

## 🔐 Безопасность

- JWT токены для API аутентификации
- Шифрование чувствительных данных
- Валидация всех входящих данных
- Логирование всех операций
- Автоматическая очистка данных
- Контроль доступа на уровне администраторов

## 📈 Масштабирование

Система спроектирована для горизонтального масштабирования:
- Множественные VPN серверы
- Балансировка нагрузки между серверами
- Кластерная база данных PostgreSQL
- Микросервисная архитектура
- Docker контейнеризация

## 🔄 Обновления и миграции

Система включает полный набор инструментов для миграций:
- Автоматические миграции схемы БД
- Backup и восстановление данных
- Откат изменений
- Проверка целостности данных

## 📞 Поддержка


- Примеры конфигураций
- Troubleshooting guide
- Логирование и мониторинг
- Telegram поддержка через бота


Проект разработан для коммерческого использования. Все права защищены.

---

